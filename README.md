# TG ↔ Google Sheets Task Tracker (PRO)

Продвинутая сборка с:
- двусторонней синхронизацией: правки в Google Sheets → сообщения в Telegram по ЛЮБЫМ полям;
- тредами по проектам/лейблам (привязка через `/bind #label` в нужном топике);
- ежедневными сводками и напоминаниями о просрочках (APScheduler, по таймзоне `TZ`).

## Быстрый старт
1. Создайте бота в @BotFather и добавьте его в супер-группу (включены форум-темы/треды).
2. Создайте таблицу `Tasks` с листом `tasks` и шапкой из `sheets.py` (функция `ensure_task_headers` справится сама при первом вызове).
3. Создайте Service Account (Google Cloud) и дайте ему доступ *Editor* на файл таблицы.
4. Замените значения в `bot/.env.example` и скопируйте как `.env`.
5. В `deploy/` положите `sa.json` (секрет сервис-аккаунта).
6. `docker compose up --build` из `deploy/`.
7. В группе зайдите в нужный тред → `/bind #frontend` (или другой лейбл). Для сводок привяжите лейбл из `SUMMARY_LABEL` (по умолчанию `#summary`).

## Команды
- `/add` — создаёт задачу. Понимает P0..P3, `@assignee`, `до YYYY-MM-DD`, `#labels`. Первый лейбл — проект.
- `/list` — `/list open`, `/list @user`, `/list #label`.
- `/done <ID>` — закрыть задачу.
- `/assign <ID> @user` — назначить.
- `/due <ID> YYYY-MM-DD` — срок.
- `/who` — сводка по назначенным.
- `/bind #label` — привязать текущий тред к лейблу.
- `/summary` — принудительно отправить сводку сейчас.

## Двусторонняя синхронизация (Sheets → TG)
Скрипт `gas/onEditNotify.gs`:
- реагирует на любые изменения в листе `tasks`;
- определяет первый лейбл строки, ищет его в листе `threads` и, если нашёл, отправляет сообщение в соответствующий тред;
- сообщение содержит ID, поле, старое и новое значение, заголовок задачи.

## План расширений
- WebApp (Apps Script) + подпись HMAC для защищённых вызовов в бот.
- Бэтчи/дебаунс уведомлений при массовых правках.
- Синхронизация форматирования дат и валидации в таблице.
